<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Representatives - Epstein Files Discharge Petition Tracker</title>
    <link rel="stylesheet" href="assets/style.css">
    <style>
        .rep-controls {
            background: white;
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }

        .search-box:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .filter-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .filter-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .rep-table-container {
            background: white;
            margin: 1rem 0;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        .rep-table {
            width: 100%;
            border-collapse: collapse;
        }

        .rep-table th,
        .rep-table td {
            text-align: left;
            padding: 12px 16px;
            border-bottom: 1px solid #e5e7eb;
        }

        .rep-table th {
            background-color: #f8fafc;
            font-weight: 600;
            color: #374151;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .rep-table tr:hover {
            background-color: #f9fafb;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-signed {
            background-color: #dcfce7;
            color: #166534;
        }

        .status-not-signed {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .status-presumed {
            background-color: #dbeafe;
            color: #1e40af;
        }

        .party-r {
            color: #dc2626;
            font-weight: 600;
        }

        .party-d {
            color: #2563eb;
            font-weight: 600;
        }

        .phone-link {
            color: var(--primary-color);
            text-decoration: none;
        }

        .phone-link:hover {
            text-decoration: underline;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .stat-card {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .back-link {
            display: inline-block;
            margin: 1rem 0;
            padding: 0.5rem 1rem;
            background: var(--primary-color);
            color: white;
            text-decoration: none;
            border-radius: 6px;
            transition: background-color 0.2s;
        }

        .back-link:hover {
            background: #1a252f;
        }

        @media (max-width: 768px) {
            .rep-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box {
                min-width: unset;
            }
            
            .rep-table {
                font-size: 0.875rem;
            }
            
            .rep-table th,
            .rep-table td {
                padding: 8px 12px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>All House Representatives</h1>
        <p class="subtitle">Complete list with contact info and Epstein discharge petition signing status</p>
    </header>

    <div class="contact-container">
        <a href="index.html" class="back-link">‚Üê Back to Main Tracker</a>
        
        <div class="summary-stats" id="summary-stats">
            <div class="stat-card">
                <div class="stat-number" id="total-reps">435</div>
                <div>Total Reps</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="confirmed-signed">217</div>
                <div>Confirmed Signed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="expected-signed">0</div>
                <div>Expected to Sign</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="not-signed">220</div>
                <div>Not Signed</div>
            </div>
        </div>

        <div class="rep-controls">
            <input type="text" class="search-box" id="searchBox" placeholder="Search by name, state, or district...">
            
            <div class="filter-group">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="signed">Confirmed (217)</button>
                <button class="filter-btn" data-filter="expected">Expected to Sign</button>
                <button class="filter-btn" data-filter="not-signed">Not Signed</button>
                <button class="filter-btn" data-filter="republican">Republican</button>
                <button class="filter-btn" data-filter="democrat">Democrat</button>
            </div>
        </div>

        <div class="rep-table-container">
            <table class="rep-table" id="representativeTable">
                <thead>
                    <tr>
                        <th>Representative</th>
                        <th>State</th>
                        <th>District</th>
                        <th>Party</th>
                        <th>Phone</th>
                        <th>Petition Status</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Representatives data will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Load and parse CSV data
        async function loadRepresentativeData() {
            try {
                // Load confirmed signers first
                const signersResponse = await fetch('data/confirmed-signers-sept10.csv');
                const signersText = await signersResponse.text();
                
                // Parse confirmed signers
                const confirmedSigners = new Set();
                const signerLines = signersText.trim().split('\n');
                for (let i = 1; i < signerLines.length; i++) {
                    const values = parseCSVLine(signerLines[i]);
                    if (values.length >= 4) {
                        const key = `${values[1]}-${values[2]}-${values[3]}`;
                        confirmedSigners.add(key);
                    }
                }
                
                // Load all representatives
                const response = await fetch('data/complete-house-119th-congress.csv');
                const csvText = await response.text();
                
                const lines = csvText.trim().split('\n');
                const headers = lines[0].split(',');
                const representatives = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const values = parseCSVLine(lines[i]);
                    if (values.length >= 7) {
                        const name = values[1] || '';
                        const state = values[2] || '';
                        const district = values[3] || '';
                        const key = `${name}-${state}-${district}`;
                        
                        // Determine accurate status based on confirmed signers
                        let status = 'NOT_SIGNED';
                        if (confirmedSigners.has(key)) {
                            status = 'SIGNED';
                        } else if (values[4] === 'D') {
                            // Democrats who haven't signed yet - most expected to sign
                            status = 'EXPECTED_TO_SIGN';
                        }
                        
                        representatives.push({
                            name: name,
                            state: state,
                            district: district,
                            party: values[4] || '',
                            status: status,
                            phone: values[6] || '',
                            notes: values[7] || ''
                        });
                    }
                }
                
                return representatives;
            } catch (error) {
                console.error('Error loading representative data:', error);
                return [];
            }
        }
        
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            return result;
        }

        let allRepresentatives = [];
        let filteredRepresentatives = [];

        async function initializePage() {
            allRepresentatives = await loadRepresentativeData();
            filteredRepresentatives = [...allRepresentatives];
            renderTable();
            updateStats();
        }

        function renderTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            filteredRepresentatives.forEach(rep => {
                const row = document.createElement('tr');
                
                let statusClass = 'status-not-signed';
                let statusText = 'Not Signed';
                
                if (rep.status === 'SIGNED') {
                    statusClass = 'status-signed';
                    statusText = 'CONFIRMED';
                } else if (rep.status === 'EXPECTED_TO_SIGN') {
                    statusClass = 'status-presumed';
                    statusText = 'Expected';
                } else if (rep.status === 'NOT_SIGNED') {
                    statusClass = 'status-not-signed';
                    statusText = 'Not Signed';
                }

                row.innerHTML = `
                    <td><strong>${rep.name}</strong></td>
                    <td>${rep.state}</td>
                    <td>${rep.district}</td>
                    <td><span class="party-${rep.party.toLowerCase()}">${rep.party}</span></td>
                    <td><a href="tel:${rep.phone}" class="phone-link">${rep.phone}</a></td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td>${rep.notes}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function filterData() {
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            const activeFilter = document.querySelector('.filter-btn.active').getAttribute('data-filter');

            filteredRepresentatives = allRepresentatives.filter(rep => {
                const matchesSearch = 
                    rep.name.toLowerCase().includes(searchTerm) ||
                    rep.state.toLowerCase().includes(searchTerm) ||
                    rep.district.toLowerCase().includes(searchTerm);

                const matchesFilter = 
                    activeFilter === 'all' ||
                    (activeFilter === 'signed' && rep.status === 'SIGNED') ||
                    (activeFilter === 'expected' && rep.status === 'EXPECTED_TO_SIGN') ||
                    (activeFilter === 'not-signed' && rep.status === 'NOT_SIGNED') ||
                    (activeFilter === 'republican' && rep.party === 'R') ||
                    (activeFilter === 'democrat' && rep.party === 'D');

                return matchesSearch && matchesFilter;
            });

            renderTable();
        }

        function updateStats() {
            const totalReps = allRepresentatives.length;
            const confirmedSigned = allRepresentatives.filter(rep => rep.status === 'SIGNED').length;
            const expectedSigned = allRepresentatives.filter(rep => rep.status === 'EXPECTED_TO_SIGN').length;
            const notSigned = allRepresentatives.filter(rep => rep.status === 'NOT_SIGNED').length;
            
            document.getElementById('total-reps').textContent = totalReps;
            document.getElementById('confirmed-signed').textContent = confirmedSigned;
            document.getElementById('expected-signed').textContent = expectedSigned;
            document.getElementById('not-signed').textContent = notSigned;
        }

        // Event listeners
        document.getElementById('searchBox').addEventListener('input', filterData);

        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                filterData();
            });
        });

        // Initialize page
        initializePage();
    </script>
</body>
</html>